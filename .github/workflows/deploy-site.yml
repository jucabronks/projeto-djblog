name: ğŸŒ Deploy Site EstÃ¡tico Simples

on:
  # Executar quando push para main
  push:
    branches: [ main ]
  
  # Permitir execuÃ§Ã£o manual
  workflow_dispatch:

# Configurar permissÃµes para GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Garantir que apenas um deploy rode por vez
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Deploy simples sem AWS/Terraform
  deploy-static:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸŒ Prepare static site
      run: |
        echo "ğŸš€ Preparando site estÃ¡tico com conteÃºdo manual preservado"
        
        # Criar estrutura do site
        mkdir -p site
        
        # Copiar HTML principal preservando conteÃºdo manual
        cp index.html site/
        
        # Criar robots.txt
        echo "User-agent: *" > site/robots.txt
        echo "Allow: /" >> site/robots.txt
        echo "Sitemap: https://jucabronks.github.io/projeto-djblog/sitemap.xml" >> site/robots.txt
        
        # Criar sitemap.xml
        echo '<?xml version="1.0" encoding="UTF-8"?>' > site/sitemap.xml
        echo '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">' >> site/sitemap.xml
        echo '  <url>' >> site/sitemap.xml
        echo '    <loc>https://jucabronks.github.io/projeto-djblog/</loc>' >> site/sitemap.xml
        echo "    <lastmod>$(date -u +%Y-%m-%d)</lastmod>" >> site/sitemap.xml
        echo '    <changefreq>daily</changefreq>' >> site/sitemap.xml
        echo '    <priority>1.0</priority>' >> site/sitemap.xml
        echo '  </url>' >> site/sitemap.xml
        echo '</urlset>' >> site/sitemap.xml
        
        # Criar health.json
        echo '{"status":"ok","message":"Site estÃ¡tico funcionando","timestamp":"'"$(date -u)"'"}' > site/health.json
        
        echo "âœ… Site preparado com sucesso!"
        echo "ğŸ“Š Arquivos criados:"
        ls -la site/
        
    - name: ğŸ“ Setup Pages
      uses: actions/configure-pages@v4
      
    - name: ğŸ“¤ Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './site'
        
    - name: ğŸš€ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

  # Job para notificar status
  notify:
    needs: generate-site
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: ğŸ“§ Notify deployment status
      if: failure()
      run: |
        echo "âš ï¸ Deploy falhou! Verifique os logs."
        
    - name: âœ… Success notification  
      if: success()
      run: |
        echo "ğŸ‰ Site atualizado com sucesso!"
        echo "ğŸŒ URL: https://${{ github.repository_owner }}.github.io/projeto-djblog"
